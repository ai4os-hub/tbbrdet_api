# .sqa/config.yml - jenkins-pipeline-library configuration file

# generic configuration: workspace, agents
config:
  credentials:
    - id: indigobot
      username_var: JPL_DOCKERUSER
      password_var: JPL_DOCKERPASS

environment:
  JPL_DOCKERPUSH: "deephdc/uc-emvollmer-deep-oc-tbbrdet_api:cpu-test"
  JPL_DOCKERFORCEBUILD: "True"
  LANG: C.UTF-8

sqa_criteria:
  Src.Install:
    repos:
      tbbrdet_api:
        container: tbbrdet_api-testing
        commands:
        - sh -c "git submodule init && git submodule update --remote --merge && pip3 install -e ./TBBRDet && pip3 install -e . && pip3 install -r requirements-test.txt"
  QC.Sty:
    repos:
      tbbrdet_api:
        container: tbbrdet_api-testing
        commands:
        - sh -c "flake8 --format=pylint tbbrdet_api"

  QC.Cov:
    repos:
      tbbrdet_api:
        container: tbbrdet_api-testing
        commands:
        - sh -c "pytest --cov=tbbrdet_api --cov-report=html:./htmlcov tbbrdet_api/tests"

  QC.Sec:
    repos:
      tbbrdet_api:
        container: tbbrdet_api-testing
        commands:
        - sh -c "bandit -r tbbrdet_api -x tests"

timeout: 1200
